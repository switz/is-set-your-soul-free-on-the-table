<!DOCTYPE html>
<html>
<head>
  <title>Is Set Your Soul Free On The Table?</title>
  <style type="text/css">
    body {
      background: #333;
      color: #FFF;
      font-size: 4em;
      display: flex;
      height: 100vh;
      width: 100vw;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-family: Helvetica, Verdana, Arial;
    }

    body {
      background: linear-gradient(238deg, #fd8800, #fd008f, #9700fd, #003dfd, #05c7e6, #4bd58d);
      background-size: 1200% 1200%;
      -webkit-animation: rainbow 6s ease infinite;
      animation: rainbow 6s ease infinite;
    }

    body.faster {
      -webkit-animation: rainbow 1s ease infinite;
      animation: rainbow 1s ease infinite;
    }

    @-webkit-keyframes rainbow {
      0% { background-position: 0% 50% }
      50% { background-position: 100% 50% }
      100% { background-position: 0% 50% }
    }
    @keyframes rainbow {
      0% { background-position: 0% 50% }
      50% { background-position: 100% 50% }
      100% { background-position: 0% 50% }
    }
  </style>

</head>
<body>
  <div>Is Set Your Soul Free On The Table?&nbsp;</div>
  <div id="content"></div>

  <script type="text/javascript">
    fetch('https://cors-anywhere.herokuapp.com/https://api.phish.net/v3/setlists/recent?apikey=F0D95586CE5BFDDB30E0', {
      mode: 'cors',
      headers: {
        Origin: window.location
      }
    })
      .then(data => data.json())
      .then(json => {
        const todaysShow = json.response.data.filter(show => show.relative_date === 'Today')[0];
        const show = json.response.data.filter(show => show.relative_date !== 'Today')[0];

        if (!show) return;

        let didPlaySetYourSoulFreeToday = false;

        if (todaysShow) {
          didPlaySetYourSoulFreeToday = /set\-your\-soul\-free/.test(todaysShow.setlistdata);
        }

        const didPlaySetYourSoulFree = /set\-your\-soul\-free/.test(show.setlistdata);

        if (didPlaySetYourSoulFreeToday) {
          document.body.classList.add('faster')
          window.content.innerHTML = 'IT WAS PLAYED TODAY! GET OUT YOUR MOONSHINE IT\'S PARTY TIME!'
          window.content.setAttribute('didPlaySetYourSoulFreeToday', true);

          return;
        }

        // is it on the table?
        window.content.innerHTML = (didPlaySetYourSoulFree ? 'IT was played last show. FUCK YEAH!' : 'Hell Yes IT Is.');
        window.content.setAttribute('didPlaySetYourSoulFree', didPlaySetYourSoulFree);
      });

  </script>

</body>
</html>